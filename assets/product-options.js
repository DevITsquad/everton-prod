class ProductOptions extends HTMLElement{constructor(){super()}connectedCallback(){this.first_variant_available="true"===this.dataset.firstVariantAvailable,this.is_product_page=null!==this.closest(".product-page--root"),this.labels=this.querySelectorAll(".disclosure--root, .radios--header"),this.options_container=this.querySelector(".product-options--container"),this.option_inputs=this.options_container.querySelectorAll('[data-item="disclosure"], [data-item="radio"]'),this.root=this.closest(`[data-product-id='${this.dataset.id}']`),this.size_chart=this.querySelector(".product-options--option .product-size-chart--root"),this.variants=JSON.parse(this.querySelector("#product-options--json").innerHTML),this.getAvailableVariants(),this.disableEmptyOptions(),this.optionChangeListener(),this.updateDisabledOptions(this.first_variant_available),this.size_chart&&this.moveSizeChart()}disconnectedCallback(){this.option_inputs.off("change.ProductOptions")}getAvailableVariants(){this.available_variants=[],this.variants.forEach(t=>{t.available&&this.available_variants.push(t.options)})}disableEmptyOptions(){const i=this.available_variants.flat(),t=this.options_container.querySelectorAll(".radios--input, .disclosure--option");t.length&&t.forEach(t=>{var e=this.getOptionValue(t);i.includes(e)||t.setAttribute("data-empty",!0)})}getOptionValue(t){return t.getAttribute("data-value")?t.getAttribute("data-value"):t.value}optionChangeListener(){this.option_inputs.on("change.ProductOptions",t=>{const a=[],e=this.options_container.querySelectorAll('[data-item="disclosure"], [data-item="radio"]:checked');e.forEach(t=>{var e=t.closest(".product-options--option").dataset.index;a.push({index:e,value:t.value})});let o=!1;this.variants.every(e=>{let i=!0;return a.forEach(t=>{i=i&&e.options[t.index]===t.value}),!i||(o=e,!1)}),this.updateVariant(o,t.target)})}updateVariant(t,e){this.updateDisabledOptions(t.available,e),this.is_product_page&&this.updateHistoryState(t.id),this.root.trigger("variantUpdated",t)}updateHistoryState(t){let e=""+location.origin+location.pathname;t&&(e+="?variant="+t),history.replaceState({path:e},"",e)}updateDisabledOptions(t,i=!1){const a=this.options_container.querySelectorAll(".radios--input, .disclosure--option");if(a.length){const o=[],s=(a.forEach(t=>{t.removeAttribute("data-unavailable"),!t.checked&&"true"!==t.getAttribute("aria-current")||o.push(t)}),this.options_container.querySelectorAll(".disclosure--current-option"));let e;!1===i?(i=o[0],e=this.getOptionValue(i)):i.classList.contains("disclosure--input")?(e=i.value,i=o.find(t=>t.getAttribute("data-value")===e)):e=i.value;const r=[],n=i.closest(".radios--container, .disclosure--form"),l=n.querySelectorAll(".radios--input, .disclosure--option"),c=(l.forEach(t=>{t=this.getOptionValue(t);t!==e&&r.push(t)}),r);this.available_variants.forEach(t=>{t.includes(e)&&t.forEach(t=>c.push(t))}),a.forEach(t=>{var e=this.getOptionValue(t);c.includes(e)||t.setAttribute("data-unavailable",!0)}),t?s&&s.forEach(t=>t.setAttribute("data-unavailable",!1)):(o.forEach(t=>t.setAttribute("data-unavailable",!0)),s&&s.forEach(t=>t.setAttribute("data-unavailable",!0)))}}moveSizeChart(){const t=this.size_chart.parentNode.querySelector("label").parentNode;t.appendChild(this.size_chart)}}const productOptionsEl=customElements.get("product-options-root");productOptionsEl||customElements.define("product-options-root",ProductOptions);